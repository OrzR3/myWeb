(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ffe6dda6"],{16:function(t,e){},17:function(t,e){},18:function(t,e){},19:function(t,e){},"1bbf":function(t,e,a){},20:function(t,e){},21:function(t,e){},22:function(t,e){},2227:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.visible?a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{visible:t.visible,modal:!0,"before-close":t.cancelModal,title:t.title,width:"400px",center:""},on:{"update:visible":function(e){t.visible=e}}},[a("div",{staticClass:"auto-scroll"},[a("div",{staticClass:"option-list"},[a("el-radio-group",{on:{change:t.radioGroupChange},model:{value:t.styleValue,callback:function(e){t.styleValue=e},expression:"styleValue"}},t._l(t.styleList,(function(e){return a("el-radio",{key:e.value,attrs:{label:e.value}},[t._v(" "+t._s(e.name)+" ")])})),1)],1),a("div",{staticClass:"flex"},[a("div",{staticClass:"max-width"}),a("div",{staticClass:"max-width"},[a("el-slider",{attrs:{min:10,step:5,disabled:1!=t.styleValue},on:{input:t.maskValueChange},model:{value:t.maskValue,callback:function(e){t.maskValue=e},expression:"maskValue"}})],1)])]),a("div",{directives:[{name:"has",rawName:"v-has",value:"sys:user:update",expression:"'sys:user:update'"}],staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{type:"primary"},on:{click:t.submit}},[t._v(" 确定 ")]),a("el-button",{attrs:{type:"default"},on:{click:t.cancelModal}},[t._v("取消")])],1)]):t._e()},s=[],n=(a("2f62"),{components:{},props:{title:{type:String,default:""}},data:function(){return{visible:!1,loading:!1,styleValue:"0",styleList:[{value:"0",name:"白色"},{value:"1",name:"马赛克"}],maskValue:0,oldMaskValue:0,oldStyleValue:"0"}},computed:{},created:function(){},methods:{initData:function(t){this.styleValue=t.styleValue,this.maskValue=t.maskValue,this.oldStyleValue=t.styleValue,this.oldMaskValue=t.maskValue,this.visible=!0},maskValueChange:function(t){var e={styleValue:this.styleValue,maskValue:t};this.visible&&this.$emit("ok",e)},radioGroupChange:function(t){var e={styleValue:t,maskValue:this.maskValue};this.visible&&this.$emit("ok",e)},submit:function(){var t=this.styleValue,e=this.maskValue;this.$emit("ok",{styleValue:t,maskValue:e}),this.visible=!1,this.$emit("close")},cancelModal:function(){this.visible=!1;var t={styleValue:this.oldStyleValue,maskValue:this.oldMaskValue};this.$emit("ok",t),this.$emit("close")}}}),o=n,r=(a("ca7e"),a("2877")),c=Object(r["a"])(o,i,s,!1,null,"134a0ce3",null);e["default"]=c.exports},23:function(t,e){},24:function(t,e){},"257c":function(t,e,a){},"2ba6":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"wrapper"},[a("div",{staticClass:"web-file"},[a("div",{staticClass:"operate-box nowrap flex justify-between"},[a("div",{staticClass:"flex btn-list"},[a("div",{staticClass:"page-btn"},[a("el-button",{attrs:{type:"default",disabled:1==t.currentPage,size:"mini"},on:{click:function(e){return t.changePdfPage(0)}}},[t._v(" 上一页 ")]),a("div",{staticClass:"page-count"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.pageCount,expression:"pageCount"}]},[t._v(t._s(t.currentPage)+" / "+t._s(t.pageCount))])]),a("el-button",{attrs:{type:"default",disabled:t.currentPage==t.pageCount,size:"mini"},on:{click:function(e){return t.changePdfPage(1)}}},[t._v(" 下一页 ")])],1),a("div",{attrs:{id:"mask-print"}},[a("el-button",{attrs:{type:"default",icon:"el-icon-printer",size:"mini"},on:{click:t.printPdf}},[t._v(" 打印 ")])],1),a("div",{attrs:{id:"mask-setting"}},[a("el-button",{attrs:{type:"default",icon:"el-icon-setting",size:"mini"},on:{click:t.attributeEdit}},[t._v(" 遮罩属性设置 ")])],1),a("div",{attrs:{id:"mask-add"}},[a("el-button",{attrs:{type:"default",size:"mini"},on:{click:t.addMask}},[t._v(" 添加遮罩 ")])],1),a("el-button",{attrs:{type:"text",icon:"el-icon-info"},on:{click:t.guide}},[t._v(" 帮助 ")])],1),a("div",{staticClass:"flex btn-list"},[a("div",{attrs:{id:"mask-back"}},[a("el-button",{attrs:{type:"default",icon:"el-icon-arrow-left",size:"mini"},on:{click:t.stepBack}},[t._v(" 回退 ")])],1),a("div",{attrs:{id:"mask-clear"}},[a("el-button",{attrs:{type:"danger",icon:"el-icon-refresh-left",size:"mini"},on:{click:t.clearClean}},[t._v(" 撤销 ")])],1),a("el-button",{attrs:{size:"mini"},on:{click:t.goBack}},[t._v("返回原文页")])],1)]),a("div",{directives:[{name:"show",rawName:"v-show",value:t.pageCount&&t.pageCount>0,expression:"pageCount && pageCount > 0"}]}),a("div",{staticClass:"mark-print-box"},[t.showPdfBoxFlag?a("div",{ref:"baseMap",staticClass:"pdf-box",attrs:{id:"pdf"}},[a("pdf",{ref:"pdf",attrs:{src:t.pdfsrc,page:t.currentPage},on:{"num-pages":function(e){t.pageCount=e},"page-loaded":t.pageLoaded,loaded:t.loadPdfHandler}}),a("div",{staticClass:"manager_detail",class:{"accurate-choice":t.accurateChoiceFlag},attrs:{id:"manager_detail"}},[a("canvas",{ref:"imgContent",staticStyle:{position:"absolute",left:"0",width:"'595.28px'",height:"'841.89px'",background:"rgba(255,255,155,0)"},attrs:{id:"canvas",width:t.canvasObj.width,height:t.canvasObj.height}})])],1):t._e(),a("div",{staticClass:"pdf-bot"})])]),t.attribute.show?a("attribute-set",{ref:"attribute",attrs:{title:t.attribute.title},on:{close:function(e){t.attribute.show=!1},ok:t.setAttribute}}):t._e()],1)},s=[],n=a("5530"),o=(a("a434"),a("ac1f"),a("1276"),a("159b"),a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),a("99af"),a("cb29"),a("7a94")),r=a("858e"),c=a("c0e9"),l=a.n(c),u=a("8baf"),d=a("2227"),h=a("c24c"),f=a.n(h),g=(a("01d7"),[{element:"#mask-setting",popover:{title:"遮罩属性设置",description:"点击按钮，可选择遮罩打印的样式，白色或者马赛克，并且可以调节马赛克的大小",position:"bottom"}},{element:"#mask-add",popover:{title:"添加遮罩",description:"点击按钮，在下方文件区域，按住鼠标左键然后拖拽，可生成遮罩打印的区域",position:"bottom"}},{element:"#mask-back",popover:{title:"回退",description:"点击按钮，回退到上一步添加的遮罩",position:"left"}},{element:"#mask-clear",popover:{title:"撤销",description:"点击按钮，撤销所有的遮罩层",position:"left"}},{element:"#mask-print",popover:{title:"打印",description:"点击按钮，可以打印添加遮罩之后的文件",position:"bottom"}}]),p=g,v={components:{pdf:r["a"],AttributeSet:d["default"]},props:{pdfsrc:{type:String,default:""}},data:function(){return{canvas:null,context:"",bgImage:null,pageCount:1,currentPage:1,clickFlag:!1,clickTimer:-1,canvasObj:{width:595.28,height:841.89},json:[],basecoordinate:[],xycoordinate:[],isMasic:!0,squareEdgeLength:20,mouse:{started:!1,x:0,y:0},accurateChoiceFlag:!1,imgUrl:"",makeGridObject:{beginX:0,beginY:0},makeList:[],fillColor:"",attribute:{show:!1,title:"属性设置",loading:!1,style:"1"},driver:null,showPdfBoxFlag:!1}},computed:{devicePixelRatio:function(){return window.devicePixelRatio||1}},created:function(){o["fabric"].Object.prototype.setControlsVisibility({bl:!1,br:!1,mb:!1,ml:!1,mr:!1,mt:!1,tl:!1,tr:!1,mtr:!1}),this.showPdfBoxFlag=!0},mounted:function(){this.driver=new f.a({animate:!0,opacity:.5,allowClose:!1,doneBtnText:"完成",closeBtnText:"关闭",nextBtnText:"下一步",prevBtnText:"上一步",onReset:function(t){}})},methods:{goBack:function(){this.$emit("back")},guide:function(){this.driver.defineSteps(p),this.driver.start()},setAttribute:function(t){this.attribute.style=t.styleValue,this.fillColor="0"==t.styleValue?"#fff":"",this.squareEdgeLength=t.maskValue,this.drawMake()},attributeEdit:function(){var t=this;this.attribute.show=!0,this.$nextTick((function(){var e={styleValue:t.attribute.style,maskValue:t.squareEdgeLength};t.$refs.attribute.initData(e)}))},addMask:function(){this.mouse.started=!0,this.initCanvasObjAndEvent(),this.accurateChoiceFlag=!0},stepBack:function(){this.makeList.length>0&&(this.makeList.splice(this.makeList.length-1,1),this.drawMake())},initCanvasObjAndEvent:function(){if(!this.canvas){this.canvas=new o["fabric"].Canvas("canvas");var t=this.$refs.imgContent;this.context=t.getContext("2d");var e=this.canvasObj,a=e.width,i=e.height,s=a/this.devicePixelRatio-1,n=i/this.devicePixelRatio-1,r=this;this.pageTransformedIntoCanvas((function(t,e){var o=new Image;o.src=t,r.bgImage=o,o.onload=function(){r.context.drawImage(o,0,0,a,i,0,0,s,n),r.context.save()}})),this.canvas.on("mouse:down",(function(t){r.mousedown(t)})),this.canvas.on("mouse:up",(function(t){r.mouseup(t)})),this.canvas.on("mouse:move",(function(t){r.mousemove(t)}))}},pageLoaded:function(t){this.currentPage=t},loadPdfHandler:function(t){},changePdfPage:function(t){var e=this;this.clickFlag||(this.clickFlag=!0,this.clickTimer=setTimeout((function(){e.clickFlag=!1}),500),0===t&&this.currentPage>1&&this.currentPage--,1===t&&this.currentPage<this.pageCount&&this.currentPage++,this.canvas&&this.canvas.clear(),this.canvas=null,this.makeList=[],this.showPdfBoxFlag=!1,this.$nextTick((function(){e.showPdfBoxFlag=!0})))},mousedown:function(t){if(!this.mouse.started)return!1;var e=this.canvas.getPointer(t.e),a=e.x,i=e.y;this.mouse=Object(n["a"])(Object(n["a"])({},this.mouse),{},{x:a,y:i}),this.makeGridObject={beginX:a,beginY:i}},mousemove:function(t){if(!this.mouse.started)return!1;var e=this.canvas.getPointer(t.e),a=Math.abs(e.x-this.mouse.x),i=Math.abs(e.y-this.mouse.y);return!(!a||!i)&&void 0},mouseup:function(t){if(!this.mouse.started)return!1;this.mouse.started=!1,this.accurateChoiceFlag=!1;t.offsetX,t.offsetY;var e=this.makeGridObject,a=e.beginX,i=e.beginY,s=this.canvas.getPointer(t.e),n=Math.abs(s.x-a),o=Math.abs(s.y-i);n>this.squareEdgeLength&&(n-=this.squareEdgeLength),o>this.squareEdgeLength&&(o-=this.squareEdgeLength);var r={beginX:a,beginY:i,w:n,h:o};this.makeList.push(r),this.drawMake()},pageTransformedIntoCanvas:function(t){l()(document.getElementById("pdf"),{allowTaint:!0,useCORS:!0,scale:this.devicePixelRatio}).then((function(e){var a=e.width,i=e.height,s=595.28,n=841.89,o=s,r=s/a*i,c=a/s*n,l=i,d=0;a>i&&(o=n,r=n/a*i);var h,f=e.toDataURL("image/jpeg",1);if(h=a<=i?new u["a"]("","pt","a4"):new u["a"]("l","pt","a4"),l<c)h.addImage(f,"JPEG",0,0,o,r);else while(l>0)h.addImage(f,"JPEG",0,d,o,r),l-=c,d-=n,l>0&&h.addPage();var g=h.output("dataurlstring");g.split("base64,")[1];t(f,h)}))},drawMake:function(){var t=this;if(this.canvas){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);var e=this.canvasObj,a=e.width,i=e.height,s=a/this.devicePixelRatio-1,n=i/this.devicePixelRatio-1;this.context.drawImage(this.bgImage,0,0,a,i,0,0,s,n),this.context.save(),this.makeList.forEach((function(e){var a=e.beginX,i=e.beginY,s=e.w,n=e.h;t.makeGrid(a,i,s,n)}))}},clearClean:function(){this.canvas&&this.canvas.clear(),this.makeList=[]},printPdf:function(){var t=this;this.pageTransformedIntoCanvas((function(e,a){var i=a.output("blob");t.print(i)}))},print:function(t){var e=(new Date).getTime(),a=document.createElement("iframe");a.style.frameborder="no",a.style.display="none",a.style.pageBreakBefore="always",a.setAttribute("id","printPdf"+e),a.setAttribute("name","printPdf"+e),a.src=window.URL.createObjectURL(t),document.body.appendChild(a),this.doPrint("printPdf"+e),window.URL.revokeObjectURL(a.src)},doPrint:function(t){var e=document.getElementById(t).contentWindow;setTimeout((function(){e.print()}),100)},makeGrid:function(t,e,a,i){for(var s=Math.round(a/this.squareEdgeLength)+1,n=Math.round(i/this.squareEdgeLength)+1,o=0;o<s*n;o++){var r=o%s*this.squareEdgeLength+t,c=parseInt(o/s)*this.squareEdgeLength+e;this.setColor(r,c)}},setColor:function(t,e){for(var a=this.context.getImageData(t,e,this.squareEdgeLength,this.squareEdgeLength).data,i=0,s=0,n=0,o=0;o<a.length;o+=4)i+=a[o],s+=a[o+1],n+=a[o+2];i=Math.round(i/(a.length/4)),s=Math.round(s/(a.length/4)),n=Math.round(n/(a.length/4)),this.drawRect(t,e,this.squareEdgeLength,this.squareEdgeLength,"rgb(".concat(i,", ").concat(s,", ").concat(n,")"),2,"rgb(".concat(i,", ").concat(s,", ").concat(n,")"))},drawRect:function(t,e,a,i,s,n,o,r){this.context.beginPath(),this.context.rect(t,e,a,i),this.context.lineWidth=n,this.fillColor&&(s=this.fillColor,o=this.fillColor),this.context.strokeStyle=o,s&&(this.context.fillStyle=s),r&&(this.context.globalAlpha=r),this.context.fill(),this.context.stroke()}}},m=v,b=(a("5e0e"),a("2877")),k=Object(b["a"])(m,i,s,!1,null,"78a953eb",null);e["default"]=k.exports},"51d8":function(t,e,a){"use strict";a("1bbf")},"5e0e":function(t,e,a){"use strict";a("257c")},"73c9":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"pdf-read"},[a("mask-print",{attrs:{pdfsrc:t.defaultPdf}})],1)},s=[],n=a("2ba6"),o=a("b68f"),r={name:"PdfRead",components:{MaskPrint:n["default"],PreviewPdf:o["default"]},props:{},data:function(){return{url:{view:"/waterMarker/viewDemo/test.pdf"}}},watch:{},computed:{testPdf:function(){return window._CONFIG["domainURL"]+"/resource/pdfjs/web/test.pdf"},defaultPdf:function(){return window._CONFIG["domainURL"]+this.url.view}},methods:{},created:function(){},mounted:function(){}},c=r,l=(a("51d8"),a("2877")),u=Object(l["a"])(c,i,s,!1,null,"29da10fa",null);e["default"]=u.exports},b68f:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"wrapper"},[a("div",{directives:[{name:"show",rawName:"v-show",value:"pdf"===t.fileType,expression:"fileType === 'pdf'"}],staticClass:"web-file"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.pageCount&&t.pageCount>0,expression:"pageCount && pageCount > 0"}]},[a("div",{staticClass:"page-btn"},[a("el-button",{attrs:{type:"primary",disabled:1==t.currentPage},on:{click:function(e){return t.changePdfPage(0)}}},[t._v("上一页")]),a("div",[t._v(t._s(t.currentPage)+" / "+t._s(t.pageCount))]),a("el-button",{attrs:{type:"primary",disabled:t.currentPage==t.pageCount},on:{click:function(e){return t.changePdfPage(1)}}},[t._v("下一页")])],1)]),a("div",{staticClass:"pdf-box"},[a("pdf",{attrs:{src:t.pdfsrc,page:t.currentPage},on:{"num-pages":function(e){t.pageCount=e},"page-loaded":t.pageLoaded,loaded:t.loadPdfHandler}})],1)])])},s=[],n=a("858e"),o={components:{pdf:n["a"]},props:{pdfsrc:{type:String,default:""}},data:function(){return{fileType:"pdf",pageCount:0,currentPage:1,clickFlag:!1,clickTimer:-1}},created:function(){this.initPdfFile()},methods:{initPdfFile:function(){this.pdfsrc=n["a"].createLoadingTask(this.pdfsrc)},pageLoaded:function(t){this.currentPage=t},loadPdfHandler:function(t){this.currentPage=1},changePdfPage:function(t){var e=this;this.clickFlag||(this.clickFlag=!0,this.clickTimer=setTimeout((function(){e.clickFlag=!1}),500),0===t&&this.currentPage>1&&this.currentPage--,1===t&&this.currentPage<this.pageCount&&this.currentPage++)}}},r=o,c=(a("ce54"),a("2877")),l=Object(c["a"])(r,i,s,!1,null,"23896994",null);e["default"]=l.exports},ca7e:function(t,e,a){"use strict";a("d253")},ce54:function(t,e,a){"use strict";a("ef48")},d253:function(t,e,a){},ef48:function(t,e,a){}}]);